using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using UnityEngine;

public class CKanaTypeEngine : CTypeEngine
{
    string[] SearchStrs = new string[2];
    const int ST_COL = 227;
    const int ST_ROW = 3;
    string[,] St = new string[ST_COL, ST_ROW];
    private string[,] DecStr = new string[,]
    {
        {"Ç™","Ç©","ÅJ"},
        {"Ç¨","Ç´","ÅJ"},
        {"ÇÆ","Ç≠","ÅJ"},
        {"Ç∞","ÇØ","ÅJ"},
        {"Ç≤","Ç±","ÅJ"},
        {"Ç¥","Ç≥","ÅJ"},
        {"Ç∂","Çµ","ÅJ"},
        {"Ç∏","Ç∑","ÅJ"},
        {"Ç∫","Çπ","ÅJ"},
        {"Çº","Çª","ÅJ"},
        {"Çæ","ÇΩ","ÅJ"},
        {"Ç¿","Çø","ÅJ"},
        {"Ç√","Ç¬","ÅJ"},
        {"Ç≈","Çƒ","ÅJ"},
        {"Ç«","Ç∆","ÅJ"},
        {"ÇŒ","ÇÕ","ÅJ"},
        {"Ç—","Ç–","ÅJ"},
        {"Ç‘","Ç”","ÅJ"},
        {"Ç◊","Ç÷","ÅJ"},
        {"Ç⁄","ÇŸ","ÅJ"},
        {"Çœ","ÇÕ","ÅK"},
        {"Ç“","Ç–","ÅK"},
        {"Ç’","Ç”","ÅK"},
        {"Çÿ","Ç÷","ÅK"},
        {"Ç€","ÇŸ","ÅK"},
        {"Éî","ÉE","ÅJ"},
        {"ÉK","ÉJ","ÅJ"},
        {"ÉM","ÉL","ÅJ"},
        {"ÉO","ÉN","ÅJ"},
        {"ÉQ","ÉP","ÅJ"},
        {"ÉS","ÉR","ÅJ"},
        {"ÉU","ÉT","ÅJ"},
        {"ÉW","ÉV","ÅJ"},
        {"ÉY","ÉX","ÅJ"},
        {"Ç∫","ÉZ","ÅJ"},
        {"É]","É\","ÅJ"},
        {"É_","É^","ÅJ"},
        {"Éa","É`","ÅJ"},
        {"Éd","Éc","ÅJ"},
        {"Éf","Ée","ÅJ"},
        {"Éh","Ég","ÅJ"},
        {"Éo","Én","ÅJ"},
        {"Ér","Éq","ÅJ"},
        {"Éu","Ét","ÅJ"},
        {"Éx","Éw","ÅJ"},
        {"É{","Éz","ÅJ"},
        {"Ép","Én","ÅK"},
        {"És","Éq","ÅK"},
        {"Év","Ét","ÅK"},
        {"Éy","Éw","ÅK"},
        {"É|","Éz","ÅK"},
    };
    public CKanaTypeEngine()
    {
        #region SetSt
        for (int i = 0; i < ST_COL; i++)
        {
            for (int k = 0; k < ST_ROW; k++)
            {
                St[i, k] = string.Empty;
            }
        }
        St[0, 0] = "Ç†"; St[0, 1] = "3";
        St[1, 0] = "Ç¢"; St[1, 1] = "e";
        St[2, 0] = "Ç§"; St[2, 1] = "4";
        St[3, 0] = "Ç¶"; St[3, 1] = "5";
        St[4, 0] = "Ç®"; St[4, 1] = "6";
        St[5, 0] = "Ç©"; St[5, 1] = "t"; St[5, 2] = "T";
        St[6, 0] = "Ç´"; St[6, 1] = "g"; St[6, 2] = "G";
        St[7, 0] = "Ç≠"; St[7, 1] = "h"; St[7, 2] = "H";
        St[8, 0] = "ÇØ"; St[8, 1] = ":"; St[8, 2] = "*";
        St[9, 0] = "Ç±"; St[9, 1] = "b"; St[9, 2] = "B";
        St[10, 0] = "Ç≥"; St[10, 1] = "x"; St[10, 2] = "X";
        St[11, 0] = "Çµ"; St[11, 1] = "d"; St[11, 2] = "D";
        St[12, 0] = "Ç∑"; St[12, 1] = "r"; St[12, 2] = "R";
        St[13, 0] = "Çπ"; St[13, 1] = "p"; St[13, 2] = "P";
        St[14, 0] = "Çª"; St[14, 1] = "c"; St[14, 2] = "C";
        St[15, 0] = "ÇΩ"; St[15, 1] = "q"; St[15, 2] = "Q";
        St[16, 0] = "Çø"; St[16, 1] = "a"; St[16, 2] = "A";
        St[17, 0] = "Ç¬"; St[17, 1] = "z";
        St[18, 0] = "Çƒ"; St[18, 1] = "w"; St[18, 2] = "W";
        St[19, 0] = "Ç∆"; St[19, 1] = "s"; St[19, 2] = "S";
        St[20, 0] = "Ç»"; St[20, 1] = "u"; St[20, 2] = "U";
        St[21, 0] = "Ç…"; St[21, 1] = "i"; St[21, 2] = "I";
        St[22, 0] = "Ç "; St[22, 1] = "1"; St[22, 2] = "!";
        St[23, 0] = "ÇÀ"; St[23, 1] = ","; St[23, 2] = "<";
        St[24, 0] = "ÇÃ"; St[24, 1] = "k"; St[24, 2] = "K";
        St[25, 0] = "ÇÕ"; St[25, 1] = "f"; St[25, 2] = "F";
        St[26, 0] = "Ç–"; St[26, 1] = "v"; St[26, 2] = "V";
        St[27, 0] = "Ç”"; St[27, 1] = "2"; St[27, 2] = "\"";
        St[28, 0] = "Ç÷"; St[28, 1] = "^"; St[28, 2] = "~";
        St[29, 0] = "ÇŸ"; St[29, 1] = "-"; St[29, 2] = "=";
        St[30, 0] = "Ç‹"; St[30, 1] = "j"; St[30, 2] = "J";
        St[31, 0] = "Ç›"; St[31, 1] = "n"; St[31, 2] = "N";
        St[32, 0] = "Çﬁ"; St[32, 1] = "]"; St[32, 2] = "}";
        St[33, 0] = "Çﬂ"; St[33, 1] = "/";
        St[34, 0] = "Ç‡"; St[34, 1] = "m"; St[34, 2] = "M";
        St[35, 0] = "Ç‚"; St[35, 1] = "7";
        St[36, 0] = "Ç‰"; St[36, 1] = "8";
        St[37, 0] = "ÇÊ"; St[37, 1] = "9";
        St[38, 0] = "ÇÁ"; St[38, 1] = "o"; St[38, 2] = "O";
        St[39, 0] = "ÇË"; St[39, 1] = "l"; St[39, 2] = "L";
        St[40, 0] = "ÇÈ"; St[40, 1] = ".";
        St[41, 0] = "ÇÍ"; St[41, 1] = ";"; St[41, 2] = "+";
        St[42, 0] = "ÇÎ"; St[42, 1] = "?"; St[42, 2] = "_";
        St[43, 0] = "ÇÌ"; St[43, 1] = "0";
        St[44, 0] = "Ç"; St[44, 1] = "?";
        St[45, 0] = "??"; St[45, 1] = "y"; St[45, 2] = "Y";
        St[46, 0] = "??"; St[46, 1] = "#";
        St[47, 0] = "??"; St[47, 1] = "E";
        St[48, 0] = "??"; St[48, 1] = "$";
        St[49, 0] = "??"; St[49, 1] = "%";
        St[50, 0] = "??"; St[50, 1] = "&";
        St[51, 0] = "??"; St[51, 1] = "Z";
        St[52, 0] = "??"; St[52, 1] = "'";
        St[53, 0] = "??"; St[53, 1] = "(";
        St[54, 0] = "??"; St[54, 1] = ")";
        St[55, 0] = "?A"; St[55, 1] = "3";
        St[56, 0] = "?C"; St[56, 1] = "e";
        St[57, 0] = "?E"; St[57, 1] = "4";
        St[58, 0] = "?G"; St[58, 1] = "5";
        St[59, 0] = "?I"; St[59, 1] = "6";
        St[60, 0] = "?J"; St[60, 1] = "t"; St[60, 2] = "T";
        St[61, 0] = "?L"; St[61, 1] = "g"; St[61, 2] = "g";
        St[62, 0] = "?N"; St[62, 1] = "h"; St[62, 2] = "H";
        St[63, 0] = "?P"; St[63, 1] = ":"; St[63, 2] = "*";
        St[64, 0] = "?R"; St[64, 1] = "b"; St[64, 2] = "B";
        St[65, 0] = "?T"; St[65, 1] = "x"; St[65, 2] = "X";
        St[66, 0] = "?V"; St[66, 1] = "d"; St[66, 2] = "D";
        St[67, 0] = "?X"; St[67, 1] = "r"; St[67, 2] = "R";
        St[68, 0] = "?Z"; St[68, 1] = "p"; St[68, 2] = "P";
        St[69, 0] = "?"; St[69, 1] = "c"; St[69, 2] = "C";
        St[70, 0] = "?^"; St[70, 1] = "q"; St[70, 2] = "Q";
        St[71, 0] = "?`"; St[71, 1] = "a"; St[71, 2] = "A";
        St[72, 0] = "?c"; St[72, 1] = "z";
        St[73, 0] = "?e"; St[73, 1] = "w"; St[73, 2] = "W";
        St[74, 0] = "?g"; St[74, 1] = "s"; St[74, 2] = "S";
        St[75, 0] = "?i"; St[75, 1] = "u"; St[75, 2] = "U";
        St[76, 0] = "?j"; St[76, 1] = "i"; St[76, 2] = "I";
        St[77, 0] = "?k"; St[77, 1] = "1"; St[77, 2] = "!";
        St[78, 0] = "?l"; St[78, 1] = ",";
        St[79, 0] = "?m"; St[79, 1] = "k"; St[79, 2] = "!";
        St[80, 0] = "?n"; St[80, 1] = "f"; St[80, 2] = "F";
        St[81, 0] = "?q"; St[81, 1] = "v"; St[81, 2] = "V";
        St[82, 0] = "?t"; St[82, 1] = "2"; St[82, 2] = "\"";
        St[83, 0] = "?w"; St[83, 1] = "^"; St[83, 2] = "~";
        St[84, 0] = "?z"; St[84, 1] = "-"; St[83, 2] = "=";
        St[85, 0] = "?}"; St[85, 1] = "j"; St[84, 2] = "J";
        St[86, 0] = "?~"; St[86, 1] = "n"; St[85, 2] = "N";
        St[87, 0] = "??"; St[87, 1] = "]"; St[87, 2] = "}";
        St[88, 0] = "??"; St[88, 1] = "/";
        St[89, 0] = "??"; St[89, 1] = "m"; St[89, 2] = "M";
        St[90, 0] = "??"; St[90, 1] = "7";
        St[91, 0] = "??"; St[91, 1] = "8";
        St[92, 0] = "??"; St[92, 1] = "9";
        St[93, 0] = "??"; St[93, 1] = "o"; St[93, 2] = "O";
        St[94, 0] = "??"; St[94, 1] = "l"; St[94, 2] = "L";
        St[95, 0] = "??"; St[95, 1] = ".";
        St[96, 0] = "??"; St[96, 1] = ";"; St[96, 2] = "+";
        St[97, 0] = "??"; St[97, 1] = "?"; St[97, 2] = "_";
        St[98, 0] = "??"; St[98, 1] = "0";
        St[99, 0] = "??"; St[99, 1] = "?";
        St[100, 0] = "??"; St[100, 1] = "y"; St[100, 2] = "Y";
        St[101, 0] = "?@"; St[101, 1] = "#";
        St[102, 0] = "?B"; St[102, 1] = "E";
        St[103, 0] = "?D"; St[103, 1] = "$";
        St[104, 0] = "?F"; St[104, 1] = "%";
        St[105, 0] = "?H"; St[105, 1] = "&";
        St[106, 0] = "?b"; St[106, 1] = "Z";
        St[107, 0] = "??"; St[107, 1] = "'";
        St[108, 0] = "??"; St[108, 1] = "(";
        St[109, 0] = "??"; St[109, 1] = ")";
        St[110, 0] = "?["; St[110, 1] = "\\"; St[110, 2] = "|";
        St[111, 0] = "?J"; St[111, 1] = "@"; St[111, 2] = "`";
        St[112, 0] = "?K"; St[112, 1] = "["; St[112, 2] = "{";
        St[113, 0] = "?u"; St[113, 1] = "?";
        St[114, 0] = "?v"; St[114, 1] = "?";
        St[115, 0] = "?A"; St[115, 1] = "<";
        St[116, 0] = "?B"; St[116, 1] = ">";
        St[117, 0] = "?E"; St[117, 1] = "?";
        St[118, 0] = "?"; St[118, 1] = "?";
        St[119, 0] = "?"; St[119, 1] = "@";
        St[120, 0] = "?"; St[120, 1] = "[";
        St[121, 0] = "?"; St[121, 1] = "?";
        St[122, 0] = "?"; St[122, 1] = "?";
        St[123, 0] = "?"; St[123, 1] = "<";
        St[124, 0] = "?"; St[124, 1] = ">";
        St[125, 0] = "?"; St[125, 1] = "?";
        St[126, 0] = " "; St[126, 1] = " ";
        St[127, 0] = "?@"; St[127, 1] = " ";
        St[128, 0] = "?P"; St[128, 1] = "1"; St[128, 2] = "!";
        St[129, 0] = "?Q"; St[129, 1] = "2"; St[129, 2] = "\"";
        St[130, 0] = "?R"; St[130, 1] = "3"; St[130, 2] = "#";
        St[131, 0] = "?S"; St[131, 1] = "4"; St[131, 2] = "$";
        St[132, 0] = "?T"; St[132, 1] = "5"; St[132, 2] = "%";
        St[133, 0] = "?U"; St[133, 1] = "6"; St[133, 2] = "&";
        St[134, 0] = "?V"; St[134, 1] = "7"; St[134, 2] = "'";
        St[135, 0] = "?W"; St[135, 1] = "8"; St[135, 2] = "(";
        St[136, 0] = "?X"; St[136, 1] = "9"; St[136, 2] = ")";
        St[137, 0] = "?O"; St[137, 1] = "0"; St[137, 2] = "?";
        St[138, 0] = "1"; St[138, 1] = "1"; St[138, 2] = "!";
        St[139, 0] = "2"; St[139, 1] = "2"; St[139, 2] = "\"";
        St[140, 0] = "3"; St[140, 1] = "3"; St[140, 2] = "#";
        St[141, 0] = "4"; St[141, 1] = "4"; St[141, 2] = "$";
        St[142, 0] = "5"; St[142, 1] = "5"; St[142, 2] = "%";
        St[143, 0] = "6"; St[143, 1] = "6"; St[143, 2] = "&";
        St[144, 0] = "7"; St[144, 1] = "7"; St[144, 2] = "'";
        St[145, 0] = "8"; St[145, 1] = "8"; St[145, 2] = "(";
        St[146, 0] = "9"; St[146, 1] = "9"; St[146, 2] = ")";
        St[147, 0] = "0"; St[147, 1] = "0"; St[147, 2] = "?";
        St[148, 0] = "a"; St[148, 1] = "a";
        St[149, 0] = "b"; St[149, 1] = "b";
        St[150, 0] = "c"; St[150, 1] = "c";
        St[151, 0] = "d"; St[151, 1] = "d";
        St[152, 0] = "e"; St[152, 1] = "e";
        St[153, 0] = "f"; St[153, 1] = "f";
        St[154, 0] = "g"; St[154, 1] = "g";
        St[155, 0] = "h"; St[155, 1] = "h";
        St[156, 0] = "i"; St[156, 1] = "i";
        St[157, 0] = "j"; St[157, 1] = "j";
        St[158, 0] = "k"; St[158, 1] = "k";
        St[159, 0] = "l"; St[159, 1] = "l";
        St[160, 0] = "m"; St[160, 1] = "m";
        St[161, 0] = "n"; St[161, 1] = "n";
        St[162, 0] = "o"; St[162, 1] = "o";
        St[163, 0] = "p"; St[163, 1] = "p";
        St[164, 0] = "q"; St[164, 1] = "q";
        St[165, 0] = "r"; St[165, 1] = "r";
        St[166, 0] = "s"; St[166, 1] = "s";
        St[167, 0] = "t"; St[167, 1] = "t";
        St[168, 0] = "u"; St[168, 1] = "u";
        St[169, 0] = "v"; St[169, 1] = "v";
        St[170, 0] = "w"; St[170, 1] = "w";
        St[171, 0] = "x"; St[171, 1] = "x";
        St[172, 0] = "y"; St[172, 1] = "y";
        St[173, 0] = "z"; St[173, 1] = "z";// St[173, 2] = "?";
        St[174, 0] = "A"; St[174, 1] = "A";
        St[175, 0] = "B"; St[175, 1] = "B";
        St[176, 0] = "C"; St[176, 1] = "C";
        St[177, 0] = "D"; St[177, 1] = "D";
        St[178, 0] = "E"; St[178, 1] = "E";
        St[179, 0] = "F"; St[179, 1] = "F";
        St[180, 0] = "G"; St[180, 1] = "G";
        St[181, 0] = "H"; St[181, 1] = "H";
        St[182, 0] = "I"; St[182, 1] = "I";
        St[183, 0] = "J"; St[183, 1] = "J";
        St[184, 0] = "K"; St[184, 1] = "K";
        St[185, 0] = "L"; St[185, 1] = "L";
        St[186, 0] = "M"; St[186, 1] = "M";
        St[187, 0] = "N"; St[187, 1] = "N";
        St[188, 0] = "O"; St[188, 1] = "O";
        St[189, 0] = "P"; St[189, 1] = "P";
        St[190, 0] = "Q"; St[190, 1] = "Q";
        St[191, 0] = "R"; St[191, 1] = "R";
        St[192, 0] = "S"; St[192, 1] = "S";
        St[193, 0] = "T"; St[193, 1] = "T";
        St[194, 0] = "U"; St[194, 1] = "U";
        St[195, 0] = "V"; St[195, 1] = "V";
        St[196, 0] = "W"; St[196, 1] = "W";
        St[197, 0] = "X"; St[197, 1] = "X";
        St[198, 0] = "Y"; St[198, 1] = "Y";
        St[199, 0] = "Z"; St[199, 1] = "Z";// St[199, 2] = "?";

        St[200, 0] = "<"; St[200, 1] = "<";// "?";
        St[201, 0] = ">"; St[201, 1] = ">";// "?";
        St[202, 0] = "??"; St[202, 1] = "<";// "?";
        St[203, 0] = "??"; St[203, 1] = ">";// "?";

        St[204, 0] = "#"; St[204, 1] = "#";
        St[205, 0] = "$"; St[205, 1] = "$";
        St[206, 0] = "%"; St[206, 1] = "%";
        St[207, 0] = "&"; St[207, 1] = "&";
        St[208, 0] = "!"; St[208, 1] = "!";
        St[209, 0] = "'"; St[209, 1] = "'";
        St[210, 0] = "("; St[210, 1] = "(";
        St[211, 0] = ")"; St[211, 1] = ")";

        St[212, 0] = "??"; St[212, 1] = "#";
        St[213, 0] = "??"; St[213, 1] = "$";
        St[214, 0] = "??"; St[214, 1] = "%";
        St[215, 0] = "??"; St[215, 1] = "&";
        St[216, 0] = "?I"; St[216, 1] = "!";
        St[217, 0] = "?f"; St[217, 1] = "'";
        St[218, 0] = "?i"; St[218, 1] = "(";
        St[219, 0] = "?j"; St[219, 1] = ")";

        St[220, 0] = "?"; St[220, 1] = "<";
        St[221, 0] = "?"; St[221, 1] = ">";
        St[222, 0] = "?A"; St[222, 1] = "<";
        St[223, 0] = "?B"; St[223, 1] = ">";
        St[224, 0] = "?C"; St[224, 1] = "<";

        St[225, 0] = "?"; St[225, 1] = "?";
        St[226, 0] = "?H"; St[226, 1] = "?";
        #endregion
        SetChangeWord();
    }
    public override List<string> MakeSearchStr(string input_textk, int str_posk)
    {
        SearchStrs[0] = string.Empty;
        SearchStrs[1] = string.Empty;
        string str_buf = MakeInputText(input_textk).Substring(str_posk, 1);

        for (int i = 0; i < ST_COL; ++i)
        {
            if (str_buf == St[i, 0])
            {
                SearchStrs[0] = St[i, 1];
                SearchStrs[1] = St[i, 2];
                break;
            }
        }
        return SearchStrs.ToList();
    }
    // ???????_??????ËY?? ??:???????J
    public override string MakeInputText(string input_textk)
    {
        string str = string.Empty;
        for (int i = 0; i < input_textk.Length; ++i)
        {
            bool update = false;
            for (int j = 0; j < DecStr.GetLength(0); ++j)
            {
                if (DecStr[j, 0] == input_textk[i].ToString())
                {
                    update = true;
                    str += DecStr[j, 1] + DecStr[j, 2];
                    break;
                }
            }
            if (!update)
            {
                str += input_textk[i];
            }
        }
        NowInputText = str;
        return str;
    }
    protected override bool InputJudge(string[] input_textk, string key, bool shift)
    {
        string temp_str = GetKeyString(key, shift);

        if (temp_str == null) return false;
        // ??v????
        if (SearchStrs[0] == temp_str || SearchStrs[1] == temp_str)
        {
            TypeMissFlag = false;

            // ???I??
            if (++StrPosK >= NowInputText.Length)
            {
                InputPos = 0;
                StrPosK = 0; // ?????(????)?|?W?V????

                // ?S???I??
                if (input_textk.Length <= ++TextPos)
                {
                    TextPos = 0;
                    return true;
                }

                // ?????????????????InputText????
                NowInputText = MakeInputText(input_textk[TextPos]);
                if (NowInputText == null)
                {
                    Debug.Log("NowInputText is null");
                    return false;
                }
            }
            MakeSearchStr(input_textk[TextPos], StrPosK);
            InputPos = StrPosK;
        }
        else // ?~?X??
        {
            TypeMissFlag = true;
        }

        return false;
    }
}
